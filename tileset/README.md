# タイルセット

タイルセットの登場によって、配信のコストが大幅に下がった (mapbox, maplibreのようなwebGLベースの描画とあわせて、高度なクライアントサイドレンダリングが可能となった。)

ラスター・ベクターの両形式で、タイルのデータが存在する。

## タイルセットの分類

### データ形式によるタイルセットの分類

- ラスター形式
  - x,y,zに応じて、最適な画像を配信する
  - 画像形式は、PNG, TIFFなど
- ベクター形式
  - ベクター形式の地理データを変換して作成
  - x,y,zに応じて、最適なベクターデータを配信する
  - 形式は、pbfなど

### ファイル形式によるタイルセットの分類

- ディレクトリ形式
  - 最も標準的な方法
  - ディレクトリにx,y,zのファイルをそれぞれ配置し、利用する
    - ディレクトリごとに、pbfファイルなどが配置される
- MBTiles
  - ラスター・ベクターの両方で利用可能
    - vector形式のものを、mapbox vector tiles (MVT) と呼ぶ
  - SQLite形式で、単一ファイル
  - 配信時にはSQLiteを解釈する必要があるため、配信サーバーを要する
    - サーバから配信する際に、x,y,zに応じたデータを配信する (配信サーバ上でディレクトリ型に変換するイメージ)
- PMTiles
  - ラスター・ベクターの両方で利用可能
  - 単一ファイル
  - 配信サーバーは不要

## タイルセットの作成方法

### 1. データの準備

- **ラスタータイルの場合**: 航空写真、衛星画像、スキャンした紙地図などの画像データ
- **ベクタータイルの場合**: シェープファイル、GeoJSON、PostGIS データベースなどのベクターデータ

### 2. タイル生成プロセス

1. **投影法の決定**: 一般的に Web Mercator（EPSG:3857）が使用されます
2. **ズームレベルの設定**: 表示する最小と最大のズームレベルを決定
3. **タイルサイズの決定**: 一般的に 256x256 または 512x512 ピクセル
4. **タイリング実行**: 選択したツールでタイル分割処理を実行

### 3. タイル生成

コマンドは別途記載

## タイルのホスティングとサービス提供

タイルセットを配信するためには、専用にホスティングサーバーが必要になる。

- **ファイルシステム**: シンプルなウェブサーバーを使用（Apache, Nginx など）
- **タイルサーバー**: GeoServer, MapServer, TileStache などの専用サーバー
- **クラウドストレージ**: Amazon S3, Google Cloud Storage などを利用
- **CDN**: Cloudflare, Akamai などのCDNを利用して高速配信
- **専用サービス**: Mapbox, ArcGIS Online などのホスティングサービス

## タイルセットの最適化

- **タイル圧縮**: PNG, JPEG, WebP などの適切な形式と圧縮レベルの選択
- **ベクターデータの単純化**: 不必要な詳細を削除し、ファイルサイズを削減
- **属性データのフィルタリング**: 必要な属性のみを含める
- **キャッシュ戦略**: クライアント側およびサーバー側でのキャッシュ設定
- **条件付きタイル読み込み**: 必要な地域のタイルのみを生成・配信
